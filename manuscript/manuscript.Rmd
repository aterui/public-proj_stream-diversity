---
title: "Ecosystem size and complexity dictate riverine biodiversity"
author:
- Akira Terui^[Department of Biology, University of North Carolina at Greensboro]
- Seoghyn Kim\footnotemark[1]
- Christine L. Dolph^[Department of Ecology, Evolution and Behavior]
output:
  html_notebook: default
abstract: |
  |This is the abstract.
bibliography: reference.bib
csl: nature.csl
---

```{r setup, include=FALSE}

pacman::p_load(tidyverse, sf)

## read gis files
filename <- list.files(path = normalizePath('../empirical/data_gis'), full.names = T)
wsd_subset <- lapply(filename[str_detect(filename, "wsd_subset")], st_read)
point_subset <- lapply(filename[str_detect(filename, "point_subset")], st_read)
shape <- lapply(filename[str_detect(filename, "shape")], st_read)
shape[[1]] <- st_set_crs(shape[[1]], st_crs(wsd_subset[[1]]))

## read theory file
dat_sim <- read_csv(normalizePath('../theory/result/result_sim2020-11-10.csv'))

n_scenario <- dat_sim %>% distinct(n_species,
                     mean_env_source,
                     sd_env_source,
                     rho,
                     asymmetry_factor,
                     min_optim,
                     max_optim,
                     sd_env_lon,
                     theta,
                     K0,
                     sd_env,
                     spatial_env_cor,
                     phi,
                     min_niche_width,
                     max_niche_width,
                     niche_cost,
                     p_dispersal,
                     min_alpha,
                     max_alpha) %>% 
  nrow()

source(normalizePath('../empirical/analysis_lm_bf.R'))

```

Ecologists have long sought to understand the general drivers of biodiversity. One of the most robust empirical generalizations in ecology is the positive relationship between species richness and area, i.e., the species-area relationship (the SAR)[@lomolinoEcologyMostGeneral2000a]. In 1921, Arrhenius[@arrheniusSpeciesArea1921] formulated the SAR as a power-law $S = cA^z$ ($S$ is the number of species observed in a given geographic area $A$), an equation currently known as the Arrhenius species-area relationship. Since then, the spatial scaling of species richness has been observed in nearly all taxonomic group, although the underlying mechanisms are still hotly debated[@ben-hurDisentanglingMechanismsUnderlying2020]. The SAR is ubiquitous because multiple mechanisms produce an apparently similar pattern. Larger ecosystems typically support more diverse metacommunities due to increased habitat diversity[@kallimanisHowDoesHabitat2008], larger metacommunity size[@ben-hurDisentanglingMechanismsUnderlying2020], and/or enhanced colonization dynamics[@lososTheoryIslandBiogeography2009]. Importantly, the SAR provides the foundation for global conservation efforts. For example, conservation ecologists have used the SAR estimates to design marine and terrestrial protected areas, which currently encompass more than ~ km² globally.

Many ecosystems, however, possess complex spatial structure that cannot be represented by area, a dimension referred to as the scale-invariant complexity[@rinaldoEvolutionSelectionRiver2014a; @rodriguez-iturbeFractalRiverBasins2001]. Such complexity is evident in branching ecosystems, including rivers, trees, and mountain ranges, to name just a few[@rodriguez-iturbeFractalRiverBasins2001]. Geomorphic or biological processes generate a pronounced self-similarity in complex branching patterns such that the part and the whole look alike. Even though the branching structure is independent of spatial scale, it forms a physical template that determines habitat diversity and dispersal corridors for living organisms[@grantLivingBranchesPopulation2007; @rinaldoRiverNetworksEcological2018]. Limited, but accumulating evidence suggests that classical concepts cannot predict ecological dynamics driven by branching structure, and this recognition has led to recent developments of spatial theories devoted to complex branching ecosystems[@altermattDiversityRiverineMetacommunities2013; @carraraComplexInteractionDendritic2014; @carraraDendriticConnectivityControls2012; @teruiMetapopulationStabilityBranching2018]. However, most research either has explored the consequences of branching complexity for local variation in species richness or relied on theoretical arguments with limited replicates of artificial branching networks. At present, we lack a comprehensive evaluation of how branching complexity, in combination with ecosystem size, scales biodiversity at the metacommunity level. Filling this knowledge gap may provide fundamental ground for achieving successful conservation in spatially complex ecosystems, where the accelerated species loss threatens the delivery of ecosystem services.

Here, we hypothesize that ecosystem size and complexity dictate biodiversity patterns in rivers, a prime example of complex branching ecosystems. In branching river networks, diverse streams recurrently join to form a larger, ecologically distinct channel. As such, the complexity of branching structure, which we define here as the probability of branching per unit river distance [@teruiMetapopulationStabilityBranching2018; @yeakelSynchronisationStabilityRiver2014a], should control the habitat heterogeneity of the ecosystem (habitat diversity per unit area). Meanwhile, ecosystem size (watershed area) should determine the metacommunity size and total habitat diversity (area x heterogeneity). We predict that ecosystem size and branching complexity increase $\gamma$ diversity by enhancing either $\alpha$ and/or $\beta$ diversity under different ecological scenarios. The present study combines theory and statistical analysis of extensive community data to provide crucial insights into how ecological communities are structured in complex branching networks.

First, we theoretically analyzed the influences of ecosystem size and branching complexity on $\gamma$ diversity. We constructed a general simulation model of metacommunity dynamics [@thompsonProcessbasedMetacommunityFramework2020], in which 50 competing species disperse and spatially interact in a random branching network. Simulated species with different niche in abiotic conditions (optimum and width) compete for resources with varied strengths. For simplicity, other ecological traits, such as dispersal probability, are assumed to be identical among species. Here, we depicted branching ecosystems as a spatial network of connected habitat patches (or a discretized river section; see **Figure 1**) where mean environmental conditions at each habitat patch are determined by two factors: (1) the headwater environments (the most upstream habitat patch) and (2) local environmental noise. Environmental values at the headwaters are drawn randomly from a normal distribution and propagates downstream with local environmental noise (i.e., the spatial autoregressive process with white noise). These values recurrently 'mix' at confluences considering the relative size of joining tributaries (see Methods). Therefore, our simulation resembles natural processes of how branching river networks create diverse habitats in a metacommunity. We prepared `r n_scenario` sets of parameter combinations with varied ecological (dispersal and competition strength) and landscape scenarios (the environmental variation at headwaters and the degree of local environmental noise). Under each scenario, we simulated metacommunity dynamics in `r max(dat_sim$n_rep)` branching networks that have different ecosystem size (the number of habitat patches: `r min(dat_sim$n_patch)` to `r max(dat_sim$n_patch)`) and complexity (branching probability: `r round(min(dat_sim$p_branch), 2)` to `r round(max(dat_sim$p_branch), 2)`) to examine their effects on $\gamma$ diversity.

Our theoretical analysis yielded results consistent with our prediction. Ecosystem size and complexity both increased $\gamma$ diversity under a realistic landscape scenario (**Figures 2 and 3**), where the environmental variation at headwaters ($\sigma_h$) is greater than the degree of local environmental noise ($\sigma_l$) [@petersonModellingDendriticEcological2013; @teruiMetapopulationStabilityBranching2018]. The relationships had a characteristic of power-law (i.e., linear in a log-log scale) and were consistent under various ecological scenarios. The strength of competition and dispersal processes (dispersal distance and probability) did not change the form of the relationships between $\gamma$ diversity and ecosystem properties. Hence, the ecosystem size and complexity are both expected to increase $\gamma$ diversity regardless of ecological scenarios.

Dispersal processes, however, affected underlying mechanisms that produce the positive effects of ecosystem size and complexity on $\gamma$ diversity. We observed a greater contribution of $\beta$ diversity, which we defined as $\frac{\gamma}{\alpha}$, to increased $\gamma$ diversity in larger and more complex ecosystems when dispersal limitation exists (i.e., species travel short distances). This pattern reflects significant spatial turnover of species composition over the branching network. In contrast, once the dispersal limitation was relaxed (species travel long distances), a clear increase in $\alpha$ diversity underpinned the positive relationships between $\gamma$ diversity and ecosystem properties. This is understandable because increased dispersal homogenizes community composition while enhancing local diversity through increased immigrants from suitable habitat patches (i.e., mass effects). These patterns were consistent across different levels of dispersal probabilities (**cite SI figure**). Our theory, therefore, highlights how the apparently similar patterns in $\gamma$ diversity emerges through different ecological pathways.

Influences of ecosystem size and complexity, however, differed significantly in their dependence on landscape scenarios. Ecosystem size had positive effects on $\gamma$ diversity regardless of landscape scenarios, although the slopes were steeper with greater environmental variation (higher $\sigma_h$ and/or $\sigma_l$). This result is attributable to the fact that larger ecosystems can hold more individuals in a metacommunity. In contrast, we observed limited or no influences of branching complexity when local environmental noise was equal to or exceeded environmental variation at headwaters ($\sigma_l \ge \sigma_h$). Under this scenario, having more branches may not contribute to the habitat diversity in the ecosystem because local environmental noise masks among-branch environmental differences. Therefore, this landscape scenario decouples the intimate relationship between branching structure and habitat diversity, thereby eliminating the positive effect of branching complexity on $\gamma$ diversity. This theoretical prediction may not apply to pristine to semi-natural river networks where individual streams with diverse geological and/or climatic backgrounds show distinctiveness in a variety of environmental conditions, including water temperature, water chemistry, substrate, and flow/sediment regimes. Instead, this result may be more relevant to severely altered landscapes where human activities compromise the environmental distinctiveness of each branch through flow regulations by dams and land use change. Hence, our theory, along with previous theoretical efforts, has important implications for riverine biodiversity conservation by pointing the crucial role of habitat diversity produced by branching structure[@holtRoleBranchingMaintenance2018].

Our theory provided important insights into how ecological communities are structured in branching networks; however, empirically testing the predictions is extremely difficult because it requires metacommunity-level replications, which are exceedingly rare. To confront this logistical challenge, we compiled existing community data of fishes from a variety of sources and developed a unique large dataset that spans across two geographic regions: the Hokkaido island in Japan and the Midwest in the United States. These regions are located in comparable ranges of latitude but support distinct fish communities. Therefore, this dataset provides an excellent opportunity to examine the generality of our theoretical predictions. After careful data selection, we estimated $\alpha$, $\beta$, and $\gamma$ diversity (asymptotic species richness; Methods) at `r nrow(wsd_subset[[1]]) + nrow(wsd_subset[[2]])` watersheds (`r nrow(wsd_subset[[1]])` in Hokkaido and `r nrow(wsd_subset[[2]])` in Midwest), each of which comprised $\ge$ 10 sites of presence-absence fish community data (a total of `r nrow(point_subset[[1]]) + nrow(point_subset[[2]])` sites). Individual watersheds, i.e., metacommunity replicates in our analysis, were considered as separated if they flow into one of the following: the ocean, a large lake ($\ge$ 10 km² in the areal area) or a large river that may represent lentic habitats ($\ge$ 5000 km² in the watershed area). We combined this dataset with geospatial information (annual mean temperature, annual cumulative precipitation, and percent forest) to account for potential influences of macro-scale drivers of species diversity. Using this dataset, we developed global and region-specific models for each of diversity measures ($\alpha$, $\beta$, and $\gamma$ diversity) to examine whether observed patterns are consistent across the two geographic regions. In the global model, we assumed that effects of ecosystem size (watershed area) and complexity (branching probability) are constant across the two regions (i.e., fixed slopes). Meanwhile, the region-specific model assumes region-specific slopes of ecosystem size and complexity by including interaction terms with the dummy binary variable of region (Hokkaido = 0; Midwest = 1). We compared the performance of these competing models using the Bayes factor, a measure of the strength of evidence in favor of one model over the alternative.

Despite the substantial difference in fish fauna between the study regions, the estimated Bayes factor in favor of the global model explaining $\gamma$ diversity was `r round(fit$gamma$bayes_factor, 1)`; this result strongly supports the consistent effects of ecosystem size and complexity on $\gamma$ diversity across the two biogeographic regions. Further, we found patterns consistent with our theoretical predictions. The estimated $\gamma$ diversity increased with increasing watershed area (ecosystem size) and branching probability (ecosystem complexity) across watersheds. These effects remained significant even after controlling for the potential influences of other environmental factors (precipitation, temperature, and land use). Overall, our statistical analysis provides strong empirical evidence that ecosystem size and complexity jointly, but independently, scale riverine biodiversity at the metacommunity level.

Similarly, we found weak to moderate supports for the global models explaining observed patterns of $\alpha$ and $\beta$ diversity (Bayes factor: `r round(fit$alpha$bayes_factor, 1)` and `r round(fit$beta$bayes_factor, 1)`, respectively). In both regions, $\beta$ diversity, rather than $\alpha$ diversity, responded significantly to ecosystem size and complexity. In our simulations, this pattern has emerged in the scenarios with dispersal limitation, which elegantly match the previous observations of stream fish movement. Direct (mark-recapture) and indirect observations (e.g., genotyping) recurrently revealed restricted movement of stream fish, typically limited to several tens to hundreds of meters in distance. Therefore, it is reasonable to observe the increased spatial turnover of species composition with increasing ecosystem size and complexity.
 
It is noteworthy that the effect of branching probability on $\gamma$ diversity was consistent across the study regions. The watersheds in the Midwest are severely altered by agriculture (median % agricultural land use: `r round(median(wsd_subset[[2]]$frac_agri)*100)`%) while the Hokkaido region is relatively intact (median % agricultural land use: `r round(median(wsd_subset[[1]]$frac_agri)*100)`%). If the land use change causes significant homogenization of in-stream habitat conditions among tributaries, theory predicts weakened effects of branching probability on $\gamma$ diversity. However, $\gamma$ diversity increased significantly with increasing branching probability in this highly modified landscape, suggesting that tributaries still sustain unique environmental conditions and contribute to high spatial turnover of species composition over the landscape (i.e., high $\beta$ diversity). Indeed, $\beta$ diversity increased with increasing branching probability in both regions (**Figure 4**). It is conceivable that even in highly modified landscape, local geological and geomorphological differences, such as slope, aspect, and
soil porosity, persist to support diversity of in-stream processes among tributaties. Although our analysis is correlative and cannot provide conclusive evidence, the finding is encouraging because branching complexity of river networks may serve as a natural defense system to human-induced environmental changes.

There may be confounding factors that could not be incorporated in our statistical models. However, we are confident on our statistical inference for the following reason. The observed patterns were elegantly consistent with our theoretical predictions that are free from any confounding factors. Further, our fitted models generally showed high R^2^ values ($\alpha$ diversity: `r round(summary(fit$alpha$model)$r.squared, 2)`; $\beta$ diversity, `r round(summary(fit$beta$model)$r.squared, 2)`; $\gamma$ diversity `r round(summary(fit$gamma$model)$r.squared, 2)`) with no signs of spatial autocorrelation in residuals. Therefore, it is very unlikely that our results were driven by spurious correlations.

While the prevailing evidence supports the scaling relationship between species diversity and ecosystem size, the importance of spatial complexity of ecosystems, especially branching structure, has not received the attention it deserves. Our results fill this knowledge gap by illuminating the dual regulation of riverine biodiversity by ecosystem size and complexity.

The emerging complexity-diversity relationship points to several important avenues for improving riverine biodiversity conservation. First and foremost, there is now clear need to explicitly consider the dimension of ecosystem complexity to achieve successful conservation. In rivers, the emerging technologies enabled us to estimate branching patterns across the globe, and there is ongoing efforts to refine global geospatial dataset. Such information may be used to identify areas that should be prioritized for conservation. Second, the complexity perspective may provide viable options to reconcile conflicts between biodiversity conservation and societal needs. Although protected areas spearhead global conservation efforts, habitat preservation and restoration over large areas are often impractical because of conflicts with stakeholders. This is particularly true for riverine ecosystems, where numerous stakeholders are involved within a single watershed and enormous efforts are required to reach consensus. In such a scenario, small-scale conservation, such as restoration of connectivity to small tributaties, could still significantly enhance the 'realized' network complexity that organisms may experience, potentially supporting biodiversity at the metacommunity level. Hence, findings from this research offer an alternative pathway to design conservation strategies in spatially complex ecosystems.


# Methods

## Model description

The metacommunity dynamics are described as a function of local community dynamics and dispersal[@thompsonProcessbasedMetacommunityFramework2020]. Specifically, the realized number of individuals $N_{ix}(t + 1)$ (species $i$ at patch $x$ and time $t+1$) is given as:

$$
N_{ix}(t + 1) \sim Poisson(n_{ix}(t) + I_{ix}(t) - E_{ix}(t))
$$
where $n_{ix}(t)$ is the expected number of individuals given the local community dynamics at time $t$, $I_{ix}$(t) the expected number of immigrants to patch $x$, and $E_{ix}$(t) the expected number of emigrants from patch $x$. Local community dynamics are simulated based on the Beverton-Holt model:

$$
n_{ix}(t) = \frac{N_{ix}(t)r_{ix}(t)}{1 + \frac{r_{0,i}-1}{K_{x}}\sum_j^S{\alpha_{ij}N_{jx}(t)}}
$$

where $r_{ix}(t)$ is the reproductive rate of species $i$ given the environmental condition at patch $x$ and time $t$, $r_{0,i}$ the maximum reproductive rate of species $i$, $K_{x}$ the carrying capacity at patch $x$, and $\alpha_{ij}$ the interaction coefficient between species $i$ and $j$. The parameter $\alpha_{ij}$ is the strength of interspecific competition relative to that of intraspecific competition (interspecific competition is greater than intraspecific competition if $\alpha_{ij}$ > 1; intraspecific competition coefficient $\alpha_{ii}$ equals 1.0). The density-independent reproductive rate $r_{ix}(t)$ is affected by environments and determined by a Gaussian function:

$$
r_{ix}(t) = cr_{0,i}~exp[{-\frac{(\mu_i-z_x(t))^2}{2\sigma^2_{niche,i}}}]
$$
where $\mu_i$ is the optimal environmental value for species $i$, $z_x(t)$ the environmental value at patch $x$ and time $t$, and $\sigma_{niche}$ the niche width of species $i$. The cost of having wider niche is expressed by multiplying $c$[@chaianunpornEvolutionaryResponsesClimate2015]:

$$
c = exp(-\frac{\sigma_{niche,i}^2}{2\nu^2})
$$

Smaller values of $\nu$ imply greater costs of having wider niche (i.e., decreased maximum reproductive rate). There is no cost if $\nu$ approaches infinity.

The environmental value $z_x(t)$, which may vary spatially and temporarily, is assumed to follow a multivariate normal distribution:

$$
z_{x}(t) \sim MVN(\mu_z, \Omega_z)
$$
$\mu_z$ is the vector of mean environmental conditions of patches and $\Omega_z$ is the variance-covariance matrix. Spatial autocorrelation is considered by describing the off-diagonal elements as:

$$
\Omega_{xy} = \sigma_z^2~exp(-\phi d_{xy})
$$
where $\Omega_{xy}$ denotes the temporal covariance of environmental conditions between patch $x$ and $y$, which is assumed to decay exponentially with increasing distance between the patches $d_{xy}$ (randomly generated or specified by argument distance_matrix). The parameter $\phi$ determines distance decay of environmental correlates.

The expected number of emigrants at time $t$, $E_{ix}(t)$, is the product of dispersal probability $p_d$ and $n_{ix}(t)$. The immigration probability at patch $x$, $\xi_{ix}$, is calculated given the structural connectivity of patch $x$, in which the model assumes the exponential decay of successful immigration with the increasing separation distance between habitat patches:

$$
\xi_{ix}(t) = \frac{\sum_{y,y \neq x}E_{iy}(t)~exp(-\theta d_{xy})}{\sum_{x} \sum_{y,y \neq x}E_{iy}(t)~exp(-\theta d_{xy})}
$$
where $d_{xy}$ is the separation distance between patch $x$ and $y$. The parameter $\theta$ dictates the dispersal distance of species ($\theta^{-1}$ corresponds to the expected dispersal distance) and is assumed to be constant across species. The expected number of immigrants is calculated as:

$$
I_{ix}(t) = \xi_{ix}(t)\sum E_{ix}
$$

# References
