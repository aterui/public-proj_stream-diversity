---
title: "Ecosystem size and complexity dictate riverine biodiversity"
author:
- Akira Terui^[Department of Biology, University of North Carolina at Greensboro]
- Seoghyn Kim\footnotemark[1]
- Christine L. Dolph^[Department of Ecology, Evolution and Behavior]
output:
  html_notebook: default
abstract: |
  |This is the abstract.
bibliography: reference.bib
csl: nature.csl
---

```{r setup, include=FALSE}

pacman::p_load(tidyverse, sf)

## read gis files
filename <- list.files(path = normalizePath('../empirical/data_gis'), full.names = T)
wsd_subset <- lapply(filename[str_detect(filename, "wsd_subset")], st_read)
point_subset <- lapply(filename[str_detect(filename, "point_subset")], st_read)
shape <- lapply(filename[str_detect(filename, "shape")], st_read)
shape[[1]] <- st_set_crs(shape[[1]], st_crs(wsd_subset[[1]]))

## read theory file
dat_sim <- read_csv(normalizePath('../theory/result/result_sim2020-11-10.csv'))

n_scenario <- dat_sim %>% distinct(n_species,
                     mean_env_source,
                     sd_env_source,
                     rho,
                     asymmetry_factor,
                     min_optim,
                     max_optim,
                     sd_env_lon,
                     theta,
                     K0,
                     sd_env,
                     spatial_env_cor,
                     phi,
                     min_niche_width,
                     max_niche_width,
                     niche_cost,
                     p_dispersal,
                     min_alpha,
                     max_alpha) %>% 
  nrow()

```


Ecologists have long sought to understand the general drivers of biodiversity. One of the most robust empirical generalizations in ecology is the positive relationship between species richness and area (the species-area relationship; SAR). In 1921, XXX formulated the SAR as a power-law $S = cA^z$ ($S$ is the number of species observed in a given geographic area $A$), which is currently called as the Arrhenius species-area relationship. Since then, the spatial scaling of species richness has been observed in nearly all taxonomic groups, although the underlying mechanisms are still hotly debated. The SAR is general because multiple mechanisms produce an apparently similar pattern. Larger ecosystems typically support more diverse metacommunities due to increased habitat diversity, larger metacommunity size, and/or enhanced colonization dynamics. Importantly, the SAR provides the foundation for global conservation efforts. For example, conservation ecologists have used the SAR estimates to design marine and terrestrial protected areas, which currently encompass more than ~ km² globally.

Many ecosystems, however, possess complex spatial structure that cannot be represented by area, a dimension known as the scale-invariant complexity. Such complexity is evident in branching ecosystems, including rivers, trees, and mountain ranges, to name just a few. Geomorphic or biological processes generate a pronounced self-similarity in complex branching patterns such that the part and the whole look alike. Even though the branching structure is independent of spatial scale, it forms a physical template that determines habitat diversity and dispersal corridors for living organisms. Evidence suggests that scale-dependent theories cannot predict ecological dynamics driven by branching structure, and this recognition has led to recent developments of spatial theories devoted to complex branching ecosystems[@altermattDiversityRiverineMetacommunities2013; @carraraComplexInteractionDendritic2014; @carraraDendriticConnectivityControls2012; @teruiMetapopulationStabilityBranching2018]. However, most research either has explored the consequences of branching complexity for local biodiversity patterns or relied on theoretical arguments with limited replicates of artificial branching networks. At present, no studies have investigated how ecosystem size and complexity jointly regulate species diversity at the metacommunity level (i. e., $\gamma$ diversity). This knowledge gap significantly limits our ability to guide biodiversity conservation in spatially complex ecosystems.

Here, we hypothesize that ecosystem size and complexity dictate $\gamma$ diversity in rivers, a prime example of complex branching ecosystems. In branching river networks, streams with diverse geological backgrounds recurrently join to form a larger, ecologically distinct channel. As such, the complexity of branching structure, which we define here as the probability of branching per unit river distance [@teruiMetapopulationStabilityBranching2018; @yeakelSynchronisationStabilityRiver2014], should control the habitat heterogeneity of the ecosystem (habitat diversity per unit area). Meanwhile, ecosystem size (watershed area) should determine the metacommunity size and total habitat diversity (area x heterogeneity). We predict that ecosystem size and branching complexity increase $\gamma$ diversity. The present study combines theory and statistical analysis of extensive community data to provide crucial insights into how ecological communities are structured in complex branching networks.

First, we theoretically analyzed the influences of ecosystem size and branching complexity on $\gamma$ diversity. We constructed a general simulation model of metacommunity dynamics [@thompsonProcessbasedMetacommunityFramework2020], in which 50 competing species disperse and spatially interact in a random branching network. Simulated species with different niche in abiotic conditions (optimum and width) compete for resources with varied strengths. For simplicity, other ecological traits, such as dispersal probability, are assumed to be identical among species. Here, branching networks are depicted as a spatial network of connected habitat patches (or a discretized river section; see **Figure 1**) where mean environmental conditions at each habitat patch are determined by two factors: (1) the headwater environments (the most upstream habitat patch) and (2) local environmental noise. Environmental values at the headwaters are drawn randomly from a normal distribution and propagates downstream with local environmental noise (i.e., the spatial autoregressive process with white noise). These values recurrently 'mix' at confluences considering the relative size of joining tributaries (see Methods). Therefore, our simulation resembles natural processes of how branching river networks create diverse habitats in a metacommunity. We prepared `r n_scenario` simulation scenarios with varied ecological (dispersal and competition strength) and landscape contexts (the environmental variation at headwaters and the degree of local environmental noise). Under each scenario, we simulated metacommunity dynamics in `r max(dat_sim$n_rep)` branching networks that have different ecosystem size (the number of habitat patches: `r min(dat_sim$n_patch)` to `r max(dat_sim$n_patch)`) and complexity (branching probability: `r round(min(dat_sim$p_branch), 2)` to `r round(max(dat_sim$p_branch), 2)`) to examine their effects on $\gamma$ diversity.

Our theoretical analysis yielded results consistent with our prediction. Ecosystem size and complexity both increased $\gamma$ diversity under a realistic landscape context (**Figures 2 and 3**), where the environmental variation at headwaters ($\sigma_h$) is greater than the degree of local environmental noise ($\sigma_l$) [@petersonModellingDendriticEcological2013; @teruiMetapopulationStabilityBranching2018]. The relationships had a characteristic of power-law (i.e., linear in a log-log scale) and were consistent under various ecological scenarios. The strength of competition and dispersal processes (dispersal distance and probability) did not change the form of the relationships between $\gamma$ diversity and ecosystem properties. Hence, the ecosystem size and complexity are both expected to increase $\gamma$ diversity regardless of ecological scenarios.

Dispersal processes, however, affected underlying mechanisms that produce the positive effects of ecosystem size and complexity on $\gamma$ diversity. We observed a greater contribution of $\beta$ diversity, which we defined as $\frac{\alpha}{\gamma}$, to increased $\gamma$ diversity in larger and more complex ecosystems when dispersal limitation exists (i.e., species travel short distances). This pattern reflects significant spatial turnover of species composition over the branching network. In contrast, once the dispersal limitation is relaxed (species travel long distances), a clear increase in $\alpha$ diversity underpinned the positive relationships between $\gamma$ diversity and ecosystem properties. This is understandable because increased dispersal homogenizes community composition while enhancing local diversity through increased immigrants from suitable habitat patches (i.e., mass effects). These patterns were consistent across different levels of emigration probabilities (**cite SI figure**). Our theory, therefore, highlights how the apparently similar patterns in $\gamma$ diversity emerges through different ecological pathways.

Influences of ecosystem size and complexity, however, differed significantly in their dependence on landscape scenarios. Ecosystem size had positive effects on $\gamma$ diversity regardless of the net habitat diversity in the ecosystem (environmental variation among headwaters + local environmental noise), though the slopes were steeper when environmental variation was greater. This is attributable to the fact that larger ecosystems can hold more individuals in a metacommunity. In contrast, the effect of branching complexity depended strongly on the environmental variation at headwaters ($\sigma_h$; see **XXX**). If environmental variation among headwaters is small, there is no foundation for branching complexity to produce diverse environmental conditions over the landscape. Therefore, this landscape scenario decouples the intimate relationship between branching structure and habitat diversity, thereby eliminating the positive effect of branching complexity on $\gamma$ diversity. This theoretical prediction may not apply to natural river networks where individual streams with diverse geological and/or climatic backgrounds show distinctiveness in a variety of environmental conditions, including water temperature, water chemistry, substrate, and flow/sediment regimes. Yet, this result illustrates the crucial role of habitat diversity produced by branching structure in the emerging complexity-$\gamma$ diversity relationship.

## Empirical evidence
We tested our theoretical predictions using a large data set of fish communities in two geographic regions: the Hokkaido island in Japan and the Midwest in the US. These regions are located in comparable ranges of latitude but support distinct fish communities. Therefore, this data set provides an excellent opportunity to examine the generality of our theoretical predictions. Our data set comprised presence-absence of fish species at XXX sites, which encompassed the majority of the two geographic regions. We estimated $\gamma$ diversity using a method of incidence-based extrapolation (i.e., the asymptotic species richness; see Methods) at `r nrow(wsd_subset[[1]]) + nrow(wsd_subset[[2]])` watersheds (`r nrow(wsd_subset[[1]])` in Hokkaido and `r nrow(wsd_subset[[2]])` in Midwest). Individual watersheds, i.e., metacommunity replicates in our analysis, were considered as independent if they flow into one of the following: the ocean, a large lake ($\ge$ 10 km² in the areal area) or a large river that may represent lentic habitats ($\ge$ 5000 km² in the watershed area).

Our empirical data analysis provided a strong support for theoretical predictions. Our theory predicts that $\gamma$ diversity increases with increasing ecosystem size and complexity. This is exactly what was observed in nature. The estimated $\gamma$ diversity increased with increasing watershed area (ecosystem size) and branching probability (ecosystem complexity) of the studied river networks. Importantly, the patterns were consistent across two geographic regions (i.e., non-significant effects of interactions with region) that support distinct fish communities. Moreover, the effects of watershed area and branching probability remained significant even after accounting for the potential influences of other environmental factors (precipitation, temperature, and land use). As predicted by theory, the scaling of $\gamma$ diversity by ecosystem size or complexity was a power-law. Given the uncertainty of estimated $\gamma$ diversity, we repeated our analysis with lower (5%) and upper (95%) confidence intervals of $\gamma$ diversity estimates. Overall, we found qualitatively similar results, implying the robustness of our findings. Our results, therefore, provides strong empirical evidence that ecosystem complexity, not only ecosystem size, represents a dimension of ecosystem properties that scale riverine biodiversity.

Detailed analysis of $\alpha$ and $\beta$ diversity patterns provides deeper insights into underlying ecological mechanisms. 
 

# Methods

